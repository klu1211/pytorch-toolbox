CreateAccuracyMetric:
  output: AccuracyMetric
  properties:
    partial_callable: true
  type: accuracy
CreateAugmentationFunction:
  output: AugmentationFunction
  properties:
    callable_arguments:
      crop_height: 512
      crop_width: 512
      height: 768
      width: 768
      with_image_wrapper: true
  type: very_simple_aug_with_elastic_transform_and_crop
CreateCSVLoggerLearnerCallback:
  output: CSVLoggerLearnerCallback
  properties:
    callable_arguments:
      save_path_creator:
        Ref:
          CreateTimeStampedSavePath: SavePathCreator
    partial_callable: true
  type: create_csv_logger
CreateCallbacks:
  output: CallbacksCreator
  properties:
    callable_arguments:
      callback_references:
        Ref:
        - CreateLabelExtractorCallback: LabelExtractorCallback
        - CreateFiveCropTTAPredictionCallback: FiveCropTTAPredictionCallback
    partial_callable: true
  type: create_callbacks
CreateCallbacksForInference:
  output: CallbacksCreator
  properties:
    callable_arguments:
      callback_references:
        Ref:
        - CreateLabelExtractorCallback: LabelExtractorCallback
        - CreateFiveCropTTAPredictionCallback: FiveCropTTAPredictionCallback
    partial_callable: true
  type: create_callbacks
CreateDataBunch:
  output: DataBunch
  properties:
    callable_arguments:
      num_workers: 28
      sampler:
        Ref:
          CreateSampler: Sampler
      test_X:
        Ref:
          LoadTestingData: test_X
      test_bs: 4
      test_ds:
        Ref:
          CreateTestingDataset: TestingDataset
      train_X:
        Ref:
          LoadTrainingData: train_X
      train_bs: 16
      train_ds:
        Ref:
          CreateTrainingDataset: TrainingDataset
      train_y:
        Ref:
          LoadTrainingData: train_y
      train_y_one_hot:
        Ref:
          LoadTrainingData: train_y_one_hot
      val_bs: 4
      val_ds:
        Ref:
          CreateValidationDataset: ValidationDataset
    partial_callable: true
  type: create_data_bunch
CreateDataBunchForInference:
  output: DataBunchCreator
  properties:
    callable_arguments:
      ds:
        Ref:
          CreateTestingDataset: TestingDataset
      num_workers: 0
    partial_callable: true
  type: create_data_bunch_for_inference
CreateDataSplitter:
  output: DataSplitter
  properties:
    callable_arguments:
      X:
        Ref:
          LoadTrainingData: train_X
      y:
        Ref:
          LoadTrainingData: train_y_one_hot
    callable_function_name: split
    initialization_arguments:
      n_splits: 3
      random_state: 4233
      test_size: 0.1
    partial_callable: true
  type: MultilabelStratifiedShuffleSplit
CreateDenormalizeFunction:
  output: DenormalizeFunction
  properties:
    partial_callable: true
  type: identity
CreateF1SoftMetric:
  output: F1SoftMetric
  properties:
    partial_callable: true
  type: f1_soft
CreateFiveCropTTAFunction:
  output: FiveCropTTAFunction
  properties:
    callable_arguments:
      crop_height: 512
      crop_width: 512
    partial_callable: true
  type: five_crop_tta_transform
CreateFiveCropTTAPredictionCallback:
  output: FiveCropTTAPredictionCallback
  properties:
    initialization_arguments:
      aggregate_mode: MAX
  type: FiveCropTTAPredictionCallback
CreateFocalLoss:
  output: FocalLoss
  properties:
    initialization_arguments:
      gamma: 2
  type: FocalLoss
CreateFocalLossMetric:
  output: FocalLossMetric
  properties:
    callable_arguments:
      gamma: 2
    partial_callable: true
  type: focal_loss
CreateGradientClippingLearnerCallback:
  output: GradientClippingLearnerCallback
  properties:
    initialization_arguments:
      clip: 1.0
    partial_initialization: true
  type: GradientClipping
CreateInference:
  output: Inference
  properties:
    callable_arguments:
      inference_data_bunch_creator:
        Ref:
          CreateDataBunchForInference: DataBunchCreator
      inference_learner_creator:
        Ref:
          CreateLearnerForInference: LearnerCreator
      result_recorder_creator:
        Ref:
          CreateResultRecorder: ResultRecorderCreator
    partial_callable: true
  type: create_inference
CreateLabelExtractorCallback:
  output: LabelExtractorCallback
  properties:
    partial_initialization: true
  type: LabelExtractorCallback
CreateLearner:
  output: LearnerCreator
  properties:
    callable_arguments:
      callback_fns_creator:
        Ref:
          CreateLearnerCallbacks: LearnerCallbacksCreator
      callbacks_creator:
        Ref:
          CreateCallbacks: CallbacksCreator
      loss_funcs:
        Ref:
        - CreateSoftF1Loss: SoftF1Loss
        - CreateFocalLoss: FocalLoss
      metrics:
        Ref:
        - CreateAccuracyMetric: AccuracyMetric
        - CreateF1SoftMetric: F1SoftMetric
        - CreateFocalLossMetric: FocalLossMetric
      model_creator:
        Ref:
          CreateModel: Model
      to_fp16: false
    partial_callable: true
  type: create_learner
CreateLearnerCallbacks:
  output: LearnerCallbacksCreator
  properties:
    callable_arguments:
      learner_callback_references:
        Ref:
        - CreateCSVLoggerLearnerCallback: CSVLoggerLearnerCallback
        - CreateOutputRecorderLearnerCallback: OutputRecorderLearnerCallback
        - CreateGradientClippingLearnerCallback: GradientClippingLearnerCallback
    partial_callable: true
  type: create_learner_callbacks
CreateLearnerForInference:
  output: LearnerCreator
  properties:
    callable_arguments:
      callbacks_creator:
        Ref:
          CreateCallbacksForInference: CallbacksCreator
      loss_funcs:
        Ref:
        - CreateLovaszHingeFlatLoss: LovaszHingeFlatLoss
        - CreateFocalLoss: FocalLoss
      metrics:
        Ref:
        - CreateAccuracyMetric: AccuracyMetric
        - CreateF1SoftMetric: F1SoftMetric
      model_creator:
        Ref:
          CreateModel: Model
      model_path: src/results/densenet121_tta/cycle_0_epoch_79.pth
      to_fp16: false
    partial_callable: true
  type: create_learner
CreateLovaszHingeFlatLoss:
  output: LovaszHingeFlatLoss
  type: LovaszHingeFlatLoss
CreateModel:
  output: Model
  properties:
    callable_arguments:
      pretrained: false
    partial_callable: true
  type: densenet121_four_channel_input_two_fc
CreateNormalizeFunction:
  output: NormalizeFunction
  properties:
    partial_callable: true
  type: identity
CreateOpenImageFunction:
  output: OpenImageFunction
  properties:
    callable_arguments:
      with_image_wrapper: true
    partial_callable: true
  type: open_numpy
CreateOutputRecorderLearnerCallback:
  output: OutputRecorderLearnerCallback
  properties:
    callable_arguments:
      denormalize_fn:
        Ref:
          CreateDenormalizeFunction: DenormalizeFunction
      save_path_creator:
        Ref:
          CreateTimeStampedSavePath: SavePathCreator
    partial_callable: true
  type: create_output_recorder
CreateResultRecorder:
  output: ResultRecorderCreator
  properties:
    partial_initialization: true
  type: ResultRecorder
CreateSampler:
  output: Sampler
  properties:
    callable_arguments:
      sampler_fn:
        Ref:
          CreateSamplerFunction: SamplerFunction
    partial_callable: true
  type: create_sampler
CreateSamplerFunction:
  output: SamplerFunction
  properties:
    partial_callable: true
  type: uniform_weights
CreateSaveModelCallback:
  output: SaveModelCallback
  properties:
    initialization_properties:
      monitor: val_loss
    partial_initialization: true
  type: SaveModelCallback
CreateSoftF1Loss:
  output: SoftF1Loss
  type: SoftF1Loss
CreateTestAugmentationFunction:
  output: TestAugmentationFunction
  properties:
    callable_arguments:
      height: 768
      width: 768
      with_image_wrapper: true
  type: resize_aug
CreateTestingDataset:
  output: TestingDataset
  properties:
    initialization_arguments:
      augment_fn:
        Ref:
          CreateTestAugmentationFunction: TestAugmentationFunction
      normalize_fn:
        Ref:
          CreateNormalizeFunction: NormalizeFunction
      open_image_fn:
        Ref:
          CreateOpenImageFunction: OpenImageFunction
      tta_fn:
        Ref:
          CreateFiveCropTTAFunction: FiveCropTTAFunction
    partial_initialization: true
  type: ProteinClassificationDataset
CreateTimeStampedSavePath:
  output: SavePathCreator
  properties:
    callable_arguments:
      save_path: /media/hd/Kaggle/human-protein-image-classification/results
    partial_callable: true
  type: create_time_stamped_save_path
CreateTrainingDataset:
  output: TrainingDataset
  properties:
    initialization_arguments:
      augment_fn:
        Ref:
          CreateAugmentationFunction: AugmentationFunction
      normalize_fn:
        Ref:
          CreateNormalizeFunction: NormalizeFunction
      open_image_fn:
        Ref:
          CreateOpenImageFunction: OpenImageFunction
    partial_initialization: true
  type: ProteinClassificationDataset
CreateTrainingScheme:
  output: TrainingScheme
  properties:
    callable_arguments:
      epochs: 80
      lr: 8e-4
    partial_callable: true
  type: training_scheme_one_cycle
CreateValidationDataset:
  output: ValidationDataset
  properties:
    initialization_arguments:
      augment_fn:
        Ref:
          CreateTestAugmentationFunction: TestAugmentationFunction
      normalize_fn:
        Ref:
          CreateNormalizeFunction: NormalizeFunction
      open_image_fn:
        Ref:
          CreateOpenImageFunction: OpenImageFunction
      tta_fn:
        Ref:
          CreateFiveCropTTAFunction: FiveCropTTAFunction
    partial_initialization: true
  type: ProteinClassificationDataset
LoadTestingData:
  output: test_X
  properties:
    callable_arguments:
      root_image_paths: /home/kevin/Documents/Kaggle/human-protein-image-classification/data/test_combined
  type: load_testing_data
LoadTrainingData:
  output:
  - train_X
  - train_y
  - train_y_one_hot
  properties:
    callable_arguments:
      root_image_paths:
      - /home/kevin/Documents/Kaggle/human-protein-image-classification/data/train_combined
      - /home/kevin/Documents/Kaggle/human-protein-image-classification/data/train_combined_HPAv18
      root_label_paths: /home/kevin/Documents/Kaggle/human-protein-image-classification/data/train_all_no_dupes.csv
  type: load_training_data
RunRecordResults:
  output: ResultRecorder
  properties:
    callable_arguments:
      result_recorder_creator:
        Ref:
          CreateResultRecorder: ResultRecorderCreator
      save_path_creator:
        Ref:
          CreateTimeStampedSavePath: SavePathCreator
    partial_callable: true
  type: record_results
RunTrainingLoop:
  properties:
    callable_arguments:
      config_saver:
        Ref:
          SaveConfiguration: ConfigSaver
      create_learner:
        Ref:
          CreateLearner: LearnerCreator
      data_bunch_creator:
        Ref:
          CreateDataBunch: DataBunch
      data_splitter_iterable:
        Ref:
          CreateDataSplitter: DataSplitter
      record_results:
        Ref:
          RunRecordResults: ResultRecorder
      training_scheme:
        Ref:
          CreateTrainingScheme: TrainingScheme
  type: training_loop
SaveConfiguration:
  output: ConfigSaver
  properties:
    callable_arguments:
      save_path_creator:
        Ref:
          CreateTimeStampedSavePath: SavePathCreator
    partial_callable: true
  type: save_config
